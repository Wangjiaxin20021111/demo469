## 我的出卷管理系统——用户使用指南

首先，这个系统设置了三个身份，第一个身份是录入题库的人，身份名称是Manager。第二个身份是出题者，身份名称是Teacher。第三个是安排考试场地的人，身份名称是
Worker。

引入了以下两个工具类（Condition类，用来判断输入的标题，题目选项等是否符合规则设定的）

```
package Condition;

/**
 * @author 25043
 */
public class Condition {
    public boolean check(String choice)
    {
        /*传入字符串长度在3到20之间的返回true,不在这个范围的返回false*/
        return choice.length() >= 3 && choice.length() <= 20;
    }
    /**选择题生成选项的工具类，传入参数为1-4，分别返回字符对应A-D**/
    public String add(int a)
    {
        String ss=null;
        switch (a)
        {
            case 1:
            {
                ss = "A";
                break;
            }
            case 2:
            {
                ss="B";
                break;
            }
            case 3:
            {
                ss="C";
                break;
            }
            case 4:
            {
                ss="D";
                break;
            }
            default:
            {
                break;
            }
        }
        return ss;
    }
}

```

（Connect类，数据库连接工具类）

```java
package Condition;

import java.sql.*;

/**
 * @author 25043
 */
public class Connect {
    public static Connection co() throws SQLException, ClassNotFoundException {
        Class.forName("com.mysql.cj.jdbc.Driver");
        String url ="jdbc:mysql://localhost:3306/Test";
        String root = "root";
        String password = "20021111aA#";
        return DriverManager.getConnection(url, root, password);
    }
    public static void close(ResultSet rr, Statement stmt, Connection coon)  {
        if(stmt!=null)
        {
            try {
                stmt.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        if(coon!=null)
        {
            try {
                coon.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
        if(rr!=null)
        {
            try {
                rr.close();
            } catch (SQLException e) {
                e.printStackTrace();
            }
        }
    }
}

```

## 下面是封装的3个类，分别是试卷类，考试场地类，试题库类

第一个：考试场地类

```java
package POJI;

/**
 * @author 25043
 */
public class ClassRoom {
    /**考试场地编号*/
    private String roomNum;
    /**试卷编号*/
    private String testNum;

    public String getTestNum() {
        return testNum;
    }

    public String getRoomNum() {
        return roomNum;
    }

    public void setTestNum(String testNum) {
        this.testNum = testNum;
    }

    public void setRoomNum(String roomNum) {
        this.roomNum = roomNum;
    }
}


```

第二个：试题库类

```java
package POJI;

/**
 * @author 25043
 */
public class QuestionBank {
    private String kind;
    private String tittle;
    private int num;

    public int getNum() {
        return num;
    }

    public String getTittle() {
        return tittle;
    }

    public String getKind() {
        return kind;
    }

    public void setNum(int num) {
        this.num = num;
    }

    public void setTittle(String tittle) {
        this.tittle = tittle;
    }

    public void setKind(String kind) {
        this.kind = kind;
    }
}

```

第三个：试卷类

```java
package POJI;

/**
 * @author 25043
 */
public class TestPaper {
    private String testNum;
    private String testName;
    private int questionNum;
    private String question;
    private String kind;

    public void setKind(String kind) {
        this.kind = kind;
    }

    public void setQuestion(String question) {
        this.question = question;
    }

    public void setQuestionNum(int questionNum) {
        this.questionNum = questionNum;
    }

    public void setTestName(String testName) {
        this.testName = testName;
    }

    public void setTestNum(String testNum) {
        this.testNum = testNum;
    }

    public String getKind() {
        return kind;
    }

    public int getQuestionNum() {
        return questionNum;
    }

    public String getQuestion() {
        return question;
    }

    public String getTestName() {
        return testName;
    }

    public String getTestNum() {
        return testNum;
    }
}

```

下面是一张图，体现“分层架构”

![image-20220325230523316](C:\Users\25043\AppData\Roaming\Typora\typora-user-images\image-20220325230523316.png)

此时的MAIN包相当于Servlet包



# 接着看main类，所有访问的进程都是从这里开始的。

- [x] ```java
  
  package MAIN;
  
  import java.sql.SQLException;
  import java.util.Scanner;
  
  /**
   * @author 25043
   */
  public class Main {
      public static void main(String[] args) throws SQLException, ClassNotFoundException {
          System.out.println("欢迎使用试卷管理系统，请选择以下身份:1为录入题库的人，2为出试卷的人,3为安排考试场地的人");
          String a;
          /*a用来判断身份*/
          String choice;
          /*choice用来选择业务*/
          String m="1",n="2",q="3";
          /*以上三个值用来防止魔法值的出现专门设置的*/
          Scanner input=new Scanner(System.in);
          /*引入Scanner类，用来输入信息*/
          a=input.next();
          while(true)
          {
              switch (a)
              {
                  /*1身份，为录入题库的人*/
                  case "1":
                  {
                      System.out.println("请选择录入试题1，修改或者删除试题2,查看试题3");
                      choice = input.next();
                      /*创建Manager对象，分别调用他的3个方法*/
                      /*Manager类也在MAIN包下面*/
                      Manager mm = new Manager();
                      /*有以下三个业务，第一个录入试题，方法为choice*/
                      if("1".equals(choice))
                      {
                          mm.choice();
                      }
                      /*第二个为修改或者删除试题的权限*/
                      else if("2".equals(choice))
                      {
                          mm.change();
                      }
                      /*第三个，出题人查看题库，为select方法*/
                      else if("3".equals(choice))
                      {
                          mm.select();
                      }
                      /*每完成一样业务跳出语句，重新进行身份选择*/
                      break;
                  }
                  case "2":
                  {
                      /*p,q防止魔法值的出现*/
                      String p="3",qq="4";
                      System.out.println("请出试卷");
                      Teacher teacher=new Teacher();
                      /*创建Teacher对象，调用方法*/
                      System.out.println("请选择以下两个您的业务1出试卷2查看试卷3添加试卷内容4查看试题库:");
                      choice=input.next();
                      /*choice进行选择，防止非法输入，倘若非法输入，进入循环，直到正确输入为止*/
                      while (!m.equals(choice)&&!n.equals(choice)&&!p.equals(choice)&&!qq.equals(choice))
                      {
                          System.out.println("请正确选择以下两个您的业务1出试卷2查看试卷3增加试卷内容4再次查看试题库:");
                          choice=input.next();
                      }
                      switch (choice)
                      {
                          case "1":
                          {
                              /*老师的业务，第一个，出试卷*/
                              teacher.makeTestPaper();
                              break;
                          }
                          case "2":
                          {
                              /*老师的业务，第二个，查看试卷*/
                              teacher.selectTestPaper();
                              break;
                          }
                          case "3":
                          {
                              /*第三个，往试卷里面新增题目*/
                              teacher.changeTestPaper();
                              break;
                          }
                          case "4":
                          {
                              /*第四个，查看题库*/
                              teacher.select();
                              break;
                          }
                          default:
                          {
                              /*永不可到达区域，但是为了代码规范仍然需要加上*/
                              break;
                          }
                      }
                      /*每完成一次业务，重新进行身份选择*/
                      break;
                  }
                  case "3":
                  {
                      /*身份3，考试场地安排者*/
                      System.out.println("安排考场");
                      /*Worker类在MAIN包下面*/
                      Worker worker=new Worker();
                      System.out.println("您有以下两样业务，第1样是安排每一场考试的场地，第2样是查看考试场地对应的考试.第3样：查看所有试题");
                      /*再次引入choice，并且进行合法判断*/
                      choice=input.next();
                      while (!m.equals(choice)&&!n.equals(choice)&&!q.equals(choice))
                      {
                          System.out.println("您正确选择您的以下两样业务，第1样是安排每一场考试的场地，第2样是查看考试场地对应的考试,3查看所有试题");
                          choice=input.next();
                      }
                      switch (choice)
                      {
                          case "1":
                          {
                              /*业务1，安排考试场地*/
                              System.out.println("请安排考试场地");
                              worker.arrange();
                              break;
                          }
                          case "2":
                          {
                              /*业务二，查看考试场地*/
                              System.out.println("查看考试场地");
                              worker.check();
                              break;
                          }
                          case "3":
                          {
                              /*业务3，查看试题*/
                              System.out.println("查看所有试题");
                              worker.select();
                              break;
                          }
                          default:
                          {
                              /*此处为永远不可到达的区域，但是为了规范，仍然设置default语句*/
                              break;
                          }
                      }
                      break;
                  }
                  default:
                  {
                      /*倘若用户非法输入，跳出switch-case语句，重新回到循环，进行身份选择*/
                      System.out.println("输入格式有错，请重新输入");
                      break;
                  }
              }
              System.out.println("请选择是否再次进入身份选择1是,其他不是");
              a=input.next();
              if("1".equals(a))
              {
                  System.out.println("欢迎使用试卷管理系统，请选择以下身份:1为录入题库的人，2为出试卷的人，3为安排考场的人");
                  a=input.next();
              }
              else
              {
                  break;
              }
          }
      }
  }
  ```

## 下面看出题人（Manager)拥有3个权限，第一个录入试题（choice)，第二个是改动/删除试题(change),第三个是查看题库（select）

录入试题部分，试题编号设为单调递增的主键。

![image-20220325210408421](C:\Users\25043\AppData\Roaming\Typora\typora-user-images\image-20220325210408421.png)

填充字段时候，无需往num部分填充，只需要往种类和问题体部分填充字段

```java
package MAIN;

import Condition.Condition;
import POJI.QuestionBank;
import Service.ManagerService;

import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Objects;
import java.util.Scanner;

public class Manager implements Select {
    /*****引入Scanner类*/
    Scanner input=new Scanner(System.in);
    /**创建Service对象********/
    ManagerService mm=new ManagerService();
    String a,b;
    /*a为用于选择题目类型是选择还是填空用的，b为判断是否继续录入题目*/
    String tittle;
    /*tittle为题目的题干+内容*/
    String tittle1;
    /*选择题后半段题目*/
    String choice;
    /*choice为进行选择题录入时候，选项内容的填充的*/
    String s;
    /*s为选择题拼接选项内容与题干时候的总和*/
    int j;
    /*j为录入选择题时候，分别代表4个选项的内容*/
    String z;
    /*z为设置单选或者多选时候的*/
    int k;
    /*k为sql语句执行成功时候的返回值*/
    int questionNum;
    /*questionnum为题库里面试题的编号*/
    String kind = null;
    /*kind为题目种类*/
    /**引入帮助类对象**/
    Condition co=new Condition();
    /**防止魔法值出现，引入m,n**/
    String m="1",n="2";
    public void choice()
    {
        while (true)
        {
            System.out.println("请选择题目类型：1为选择题，2为填空");
            a = input.next();
            /*首先进行题目类型判断*/
            switch (a)
            {
                case "1":
                {
                    /*进入了1号case里面时候，将会判断单选还是多选，用户自己选择，如果非法输入，会进入循环，直到输入正确为止*/
                    System.out.println("请设置单选还是多选,单选1，多选2");
                    z=input.next();
                    System.out.println(z);
                    /*m的默认值为1，n的默认值为2已经在常量池里面设定了*/
                    while (!Objects.equals(z, m) && !Objects.equals(z, n))
                    {
                        System.out.println("请正确设置单选还是多选,单选1，多选2");
                        z=input.next();
                    }
                    /*通过switch-case语句来选择对应的题目种类*/
                    switch (z)
                    {
                        /*类型1设为单选，类型2为多选*/
                        case "1":
                        {
                            System.out.println("单选");
                            kind="单选";
                            break;
                        }
                        case "2":
                        {
                            System.out.println("多选");
                            kind="多选";
                            break;
                        }
                        default:{
                            /*永不可到达区域，但是为了规范，仍然要设置*/
                            break;
                        }
                    }
                    /*设置选择题题目*/
                    System.out.println("请设置选择题的题目");
                    tittle=input.next();
                    /*借助帮助类指定长度输入*/
                    while (!co.check(tittle))
                    {
                        System.out.println("您输入的格式不正确，请再次输入");
                        tittle=input.next();
                    }
                    tittle=tittle+"\n";
                    System.out.println(tittle);
                    int q=4;
                    System.out.println("请分别设置4个选项的内容");
                    for(j=1;j<=q;j++)
                    {
                        /*分别设置4个选项的内容*/
                        System.out.println("请设置第"+j+"st个选项的内容：");
                        s=input.next();
                        /*判断选项是否满足条件*/
                        if(co.check(s))
                        {
                            if(j>1)
                            {
                                choice=choice+co.add(j)+"."+s+"\t";
                            }
                            else {
                                choice=co.add(j)+"."+s+"\t";
                            }
                        }
                        /*如果不是就让j自减，然后重新开始计算*/
                        else
                        {
                            System.out.println("您输入的格式不正确");
                            j--;
                        }
                    }
                    /*完成题目和选项内容的填充之后，重新为s赋值，调用ManagerService中的方法完成内容填充*/
                    s=tittle+"\t"+choice;
                    k = mm.insert(kind,s);
                   if (k > 0)
                   {
                    System.out.println("您已经成功录入1题选择题！");
                   }
                    else {
                       System.out.println("未成功录入！");
                   }
                    break;
                }
                case "2":
                {
                    System.out.println("填空");
                    System.out.println("请设置填空题题目");
                    tittle=input.next();
                    /*填空题的格式为：前半段题目+【    】+后半段题目*/
                    while (!co.check(tittle))
                    {
                        System.out.println("请再次设置填空题题目");
                        tittle=input.next();
                    }
                    System.out.println("题目是"+tittle);
                    tittle=tittle+"【      】";
                    System.out.println("请设置后半段题目");
                    tittle1=input.next();
                    while (!co.check(tittle1))
                    {
                         System.out.println("请按照正确形式输入");
                         tittle1=input.next();
                    }
                    tittle=tittle+tittle1;
                    kind="填空";
                    k=mm.insert(kind,"  "+tittle+"  ");
                    if (k > 0)
                    {
                        System.out.println("您已经成功录入1题填空！");
                    }
                    else
                    {
                        System.out.println("未成功录入！");
                    }
                    break;
                }
                default:
                {
                    break;
                }
            }
            System.out.println("请选择是否继续录入信息，1是,其他不是");
            b = input.next();
            if ("1".equals(b))
            {
                System.out.println("继续录入!");
            }
            else
            {
                break;
            }
        }
    }

    public void change() throws SQLException, ClassNotFoundException {
        /*删除和修改部分，可以选择删除或者修改1删2改*/
        String ss;
        /*ss也是用来作为选择的*/
        String num;
        /*题目序号*/
        String choice;
        String choice1 = null;
        System.out.println("请选择删除还是修改1删2改:");
        String m="1",n="2";
        ss=input.next();
        /*ss此处把ss设置为仅有可能的两种情况*/
        while (!m.equals(ss)&&!n.equals(ss))
        {
            System.out.println("请正确选择删除还是修改1删2改:");
            ss=input.next();
        }
        System.out.println("请选择您需要操作的题目，输入题目序号:");
        num=input.next();
        int cc=3;
        /*防止魔法值的出现，特意设定的cc*/
        while(num.length()>=cc||num.length()==0)
        {
            System.out.println("请选择您需要操作的题目，输入题目序号:");
            num=input.next();
        }
        switch (ss)
        {
            case "1":
            {
                /*如果选择了1，将指定删除序号为num的列数*/
                int a=mm.change(num, null,null);
                if(a>0)
                {
                    System.out.println("删除成功!");
                }
                else
                {
                    System.out.println("未查询到此题目!");
                }
                break;
            }
            case "2":
            {
                System.out.println("请输入您想把此题目类型改成什么类型1选择，2填空");
                choice=input.next();
                while (!m.equals(choice)&&!n.equals(choice))
                {
                    System.out.println("请正确输入您想把此题目类型改成什么类型1选择，2填空");
                    choice=input.next();
                }
                switch (choice)
                {
                    case "1":
                    {
                        System.out.println("请设置单选还是多选,单选1，多选2");
                        z=input.next();
                        System.out.println(z);
                        String aa="1",bb="2";
                        while (!Objects.equals(z, aa) && !Objects.equals(z, bb))
                        {
                            System.out.println("输入错误，请再次选择");
                            System.out.println("请设置单选还是多选,单选1，多选2");
                            z=input.next();
                        }
                        switch (z)
                        {
                            case "1":
                            {
                                System.out.println("单选");
                                kind="单选";
                                break;
                            }
                            case "2":
                            {
                                System.out.println("多选");
                                kind="多选";
                                break;
                            }
                            default:{
                                break;
                            }
                        }
                        System.out.println("请设置选择题的题目");
                        tittle=input.next();
                        while (!co.check(tittle))
                        {
                            System.out.println("您输入的格式不正确，请再次输入");
                            tittle=input.next();
                        }
                        tittle=tittle+"\n";
                        System.out.println(tittle);
                        int g=4;
                        System.out.println("请分别设置4个选项的内容");
                        for(j=1;j<=g;j++)
                        {
                            System.out.println("请设置第"+j+"st个选项的内容：");
                            s=input.next();
                            if(co.check(s))
                            {
                                if(j>1)
                                {
                                    choice1=choice1+co.add(j)+"."+s+"\t";
                                }
                                else {
                                    choice1=co.add(j)+"."+s+"\t";
                                }
                            }
                            else
                            {
                                System.out.println("您输入的格式不正确");
                                j--;
                            }
                        }
                        s=tittle+"\t"+choice1;
                        k = mm.change(num,s,kind);
                        if (k > 0)
                        {
                            System.out.println("您已经成功修改1题选择题！");
                        }
                        else {
                            System.out.println("未成功修改！");
                        }
                        break;
                    }
                    /*题目类型设为填空题*/
                    case "2":
                    {
                        System.out.println("请设置题目的内容");
                        s=input.next();
                        kind="填空";
                        while(!co.check(s))
                        {
                            System.out.println("请按照要求设置题目的内容:");
                            s=input.next();
                        }
                        s=s+"【     】";
                        System.out.println("请输入后半段题目");
                        tittle1=input.next();
                        while(!co.check(tittle1))
                        {
                            System.out.println("请按照要求设置题目的内容:");
                            tittle1=input.next();
                        }
                        s=s+tittle1;
                        /*num为题目序号（主键）s为修改后的内容，kind为修改后的题目类型*/
                        k=mm.change(num,s,kind);
                        if(k>0)
                        {
                            System.out.println("更改成功！");
                        }
                        else
                        {
                            System.out.println("未更改成功!");
                        }
                        break;
                    }
                    default:
                    {
                        break;
                    }
                }
                break;
            }
            default:{
                break;
            }
        }
    }
    @Override
    public void select() throws SQLException, ClassNotFoundException {
        String m1,j1,a1;
        /*m1为用户选择查看的方式题目的方式，a1为题目的序号，tittle为题目的内容*/
        String k=null;
        String all;
        String tittle;
        ArrayList<QuestionBank> list=null;
        while(true)
        {
            System.out.println("您有以下三种方式可以查看，第1种，通过题号查看，第2种，通过题目类别查看，第3种，全部都查看,第四种，根据内容查看");
            /*从1234选项当中正确选择*/
            m1=input.next();
            switch (m1)
            {
                case "1":
                {
                    /*1号case，通过题目序号查看*/
                    System.out.println("请输入您想查看的题目序号");
                    a1=input.next();
                    k=null;
                    /*check方法传递的四个参数都是条件：a1:题目序号，kind：题目种类，all全部查看，tittle题目内容模糊查询*/
                    list=mm.check(a1, null, null, null);
                    break;
                }
                case "2":
                {
                    /***2号case：通过题目类别查看****/
                    System.out.println("请选择题目类别：1单选，2多选，3填空");
                    j1=input.next();
                    String p="2",q="3";
                    while(!"1".equals(j1)&& !p.equals(j1)&&!q.equals(j1))
                    {
                        System.out.println("请正确选择!");
                        System.out.println("请选择题目类别：1单选，2多选，3填空");
                        j1=input.next();
                    }
                    switch (j1)
                    {
                        case "1":
                        {
                            k="单选";
                            break;
                        }
                        case "2":
                        {
                            k="多选";
                            break;
                        }
                        case "3":
                        {
                            k="填空";
                            break;
                        }
                        default:
                        {
                            break;
                        }
                    }
                    a1= String.valueOf(0);
                    list=mm.check(a1,k, null, null);
                    break;
                }
                case "3":
                {
                    all="all";
                    a1= String.valueOf(0);
                    k=null;
                    list=mm.check(a1, null,all, null);
                    break;
                }
                case "4":
                {
                    System.out.println("请输入题目的模糊字样");
                    tittle=input.next();
                    while (!co.check(tittle))
                    {
                        System.out.println("输入的格式不正确，请重新输入");
                        tittle=input.next();
                    }
                    System.out.println(tittle);
                    a1= String.valueOf(0);
                    k=null;
                    list=mm.check(a1, null, null,tittle);
                    break;
                }
                default:
                {
                    break;
                }
            }
            if(list!=null)
            {
                for (QuestionBank questionBank : list)
                {
                    tittle = questionBank.getTittle();
                    questionNum = questionBank.getNum();
                    kind = questionBank.getKind();
                    System.out.println("题目序号是:" + questionNum + "..." + "题目种类是:" + kind + "..." + "题目内容是:" + tittle);
                }
            }
            else
            {
                System.out.println("没有您选择的类型的题目可以查看");
            }
            System.out.println("请选择是否继续查看，1是其他退出查看");
            a=input.next();
            if("1".equals(a))
            {
                System.out.println("继续!");
            }
            else {
                break;
            }
        }
    }
}

```

```

```

下面是ManagerService代码块

```java
package Service;

import DAO.ManagerDAO;
import POJI.QuestionBank;
import java.util.ArrayList;

/**
 * @author 25043
 */
public class ManagerService {
    /*Service层创建DAO对象*/
    ManagerDAO managerDAO=new ManagerDAO();
    public int insert(String kind,String s)
    {
        /*s代表问题体，kind代表种类，执行成功，返回1，否则0*/
        int k;
        String sql="insert into QuestionBank(kind,Question) values(?,?)";
        k=managerDAO.insert(sql,kind,s);
        return k;
    }
    public ArrayList<QuestionBank> check(String num,String kind,String all,String tittle) {
        ArrayList<QuestionBank> list;
        System.out.println(num+kind+all+tittle);
        String sql=null;
        String q="0";
        /*以下，每一项当中，哪一项不为空，将执行对应的sql语句*/
        if(!q.equals(num))
        {
            /*根据题目编号查询*/
            sql="select*from QuestionBank where num=?";
        }
        if(kind!=null)
        {
            /*根据题目种类查询*/
            sql="select*from QuestionBank where kind=?";
        }
        if(all!=null)
        {
            /*全部查询*/
            sql="select*from QuestionBank";
        }
        if(tittle!=null)
        {
            /*根据内容模糊查询*/
            sql="select*from QuestionBank where Question like  ?";
        }
        list=managerDAO.find(sql, String.valueOf(num),kind,all,tittle);
        return list;
    }

    public int change(String num, String choice,String kind) {
        /*choice为修改之后题目的内容,kind为修改之后题目的种类*/
        int a;
        /*a为判断返回值*/
        String sql;
        String sql1;
        String deleteConnect;
        /*choice为空，说明是删除功能，将执行删除的sql语句*/
        if(choice==null)
        {
            sql="delete from QuestionBank where num=?";
            deleteConnect="delete from connect where questionnum=?";
            /*由于建立了中间表connect，因此，为了不影响正常删除，应当把connect部分的内容先删除了，*/
            a=managerDAO.change(null,sql,num,null,kind,deleteConnect);
        }
        /*choice不为空，说明是修改功能，将执行修改的sql语句*/
        else
        {
             sql="update QuestionBank set Question=? where num=?";
             sql1="update QuestionBank set kind=? where num=?";
             a=managerDAO.change(sql1,sql,num,choice,kind, null);
        }
        return a;
    }
}

```

下面是ManagerDAO部分

```Java
package DAO;

import Condition.Connect;
import POJI.QuestionBank;

import java.sql.*;
import java.util.ArrayList;

/**
 * @author 25043
 */
public class ManagerDAO {
    /**常量池部分，把四个对象赋初值为null**/
    Connection coon=null;
    Statement stmt=null;
    ResultSet rr=null;
    PreparedStatement ptsmt=null;
    ArrayList<QuestionBank> list=null;
    public int insert(String sql,String kind,String s)  {
        try {
            int a;
            coon= Connect.co();
            stmt=coon.createStatement();
            /*预编译处理sql语句*/
            ptsmt=coon.prepareStatement(sql);
            /*设置第一个问号为题目种类，第二个为题目内容*/
            ptsmt.setString(1,kind);
            ptsmt.setString(2,s);
            a= ptsmt.executeUpdate();
            return a;
        }catch (Exception e)
        {
            e.printStackTrace();
            return 0;
        }finally {
            Connect.close(rr,stmt,coon);
        }
    }

    public ArrayList<QuestionBank> find(String sql,String a,String kind,String all,String tittle ) {
        try {
            /*根据条件执行sql语句*/
            list = new ArrayList<>();
            String question;
            String kind1;
            QuestionBank questionBank;
            int a1;
            coon = Connect.co();
            stmt = coon.createStatement();
           /*all不为空时候，直接执行sql语句，返回结果集对象rr*/
            if (all != null)
            {
                rr = stmt.executeQuery(sql);
            }
            /*哪一项内容不为空，就用预编译的命令执行它，同时返回一个结果集对象*/
            else
            {
                ptsmt = coon.prepareStatement(sql);
                if (a != null)
                {
                    /*a为题目序号，根据序号来查询题目*/
                    ptsmt.setString(1, a);
                    rr = ptsmt.executeQuery();
                }
                if (kind != null)
                {
                    /*kind为题目种类，根据题目种类来查询*/
                    ptsmt.setString(1, kind);
                    rr = ptsmt.executeQuery();
                }
                if (tittle != null)
                {
                    /*tittle为题目的内容，根据内容进行模糊查询*/
                    System.out.println("hh");
                    ptsmt.setString(1, "%" + tittle + "%");
                    System.out.println("hehe");
                    rr = ptsmt.executeQuery();
                }
            }
            /*结果集遍历试题库*/
            while (rr.next())
            {
                questionBank = new QuestionBank();
                /*获取题目序号*/
                a1 = rr.getInt(1);
                /*获取问题体*/
                question = rr.getString(2);
                /*获取题目种类*/
                kind1 = rr.getString(3);
                questionBank.setNum(a1);
                questionBank.setTittle(question);
                questionBank.setKind(kind1);
                /*往集合当中添加元素*/
                list.add(questionBank);
            }
            if (list.size() > 0)
            {
                return list;
            }
            else
            {
                return null;
            }
        }catch (Exception e)
        {
            e.printStackTrace();
            return null;
        }finally {
            Connect.close(rr,stmt,coon);
        }
    }

    public int change(String sql1,String sql, String num, String choice,String kind,String deleteConnect) {
        try {
            int k, k1, n;
            coon = Connect.co();
            stmt = coon.createStatement();
            /*修改/删除的部分，如果choice为空，执行删除语句*/
            if (choice == null)
            {
                ptsmt = coon.prepareStatement(deleteConnect);
                ptsmt.setString(1, num);
                n = ptsmt.executeUpdate();
                System.out.println(n);
                ptsmt = coon.prepareStatement(sql);
                ptsmt.setString(1, num);
                k = ptsmt.executeUpdate();
                System.out.println(k);
                if (k > 0 && n > 0) {
                    return 1;
                } else {
                    return 0;
                }
            } 
            /*choice不为空，执行修改语句*/
            else 
            {
                ptsmt = coon.prepareStatement(sql);
                /*第一个问号代表修改之后的内容，第二个代表修改之后的种类*/
                ptsmt.setString(1, "  "+choice+"  ");
                ptsmt.setString(2, num);
                k = ptsmt.executeUpdate();

                ptsmt = coon.prepareStatement(sql1);
                ptsmt.setString(1, kind);
                ptsmt.setString(2, num);
                k1 = ptsmt.executeUpdate();
                if (k > 0 && k1 > 0) {
                    return k;
                } else {
                    return 0;
                }
            }
        }catch (Exception e)
        {
            e.printStackTrace();
            return 0;
        }
        finally {
            Connect.close(rr,stmt,coon);
        }
    }
}

```

```

```

## 接下来是出题人(Teacher的介绍，他拥有从题库中提取题目组卷makeTestPaper方法，和select方法，查看试题库的试题，selectTestPaper查看自己出过的试题（有题目的情况下），以及往试卷当中重新增添题目（changeTestPaper）的方法，前提是试卷库当中已经有了对应的试卷)，

分析：一张试卷可以有多道题目，一道题目也可以被多张试卷采用，那么试卷和题库的关系应该是多对多，需要借助第三张中间表connect。

下面是3张表的展示：

第一张，考试表，仅有两个字段，一个是试题编号，另外一个是考试的名称，试题编号作为主键，为某张试题的标志。

![image-20220325210002721](C:\Users\25043\AppData\Roaming\Typora\typora-user-images\image-20220325210002721.png)

第二张：中间表connect，用来连接testpaper和questionbank的



![image-20220325210629618](C:\Users\25043\AppData\Roaming\Typora\typora-user-images\image-20220325210629618.png)

testnum关联试题的testnum，questionnum关联questionbank的序号

下面是questionabnk表

![image-20220325210903727](C:\Users\25043\AppData\Roaming\Typora\typora-user-images\image-20220325210903727.png)

num作为题目的主键

三表联查的结果（默认查询全部）

![image-20220325215741686](C:\Users\25043\AppData\Roaming\Typora\typora-user-images\image-20220325215741686.png)

下面是Teacher的类

```java
package MAIN;

import Condition.Condition;
import POJI.TestPaper;
import Service.TeacherService;

import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Scanner;

/**
 * @author 25043
 */
public class Teacher implements Select{
    /**创建TeacherService对象tr**/
    TeacherService tr=new TeacherService();
    /**创建帮助类对象**/
    Condition co=new Condition();
    /**创建试题对象，属性包括：试题编号，考试名称，题目编号，题目内容，题目类型**/
    ArrayList<TestPaper> list=null;
    /**判断专用choice**/
    String choice;
    /**防止魔法值4出现**/
    int a=4;
    /**引入Scanner类完成录入**/
    Scanner input=new Scanner(System.in);
    /**引入Teacher对象**/
    Teacher teacher;
    /**制作试卷的方法**/
    public void makeTestPaper()
    {
           int check;//check为检验是否录入成功的编号
           String testNum;//试题编号
           String testName;//考试名称
            //题目的编号，初始值为空
           String question=null;
           //创建教师对象
           teacher=new Teacher();
           while (true)
           {
               System.out.println("请设置当前试卷的编码，一旦设置，不能更改");
               testNum=input.next();
               /*设置试卷的编号*/
               System.out.println("请输入考试名称");
               /*设置考试的名称*/
               testName=input.next();
               /*二者都要符合命名规范，任何一个不规范都会要求重新输入*/
               while(!co.check(testNum)||!co.check(testName))
               {
                   System.out.println("请正确设置当前试卷的编码，一旦设置，不能更改");
                   testNum=input.next();
                   System.out.println("请正确设置考试名称");
                   testName=input.next();
               }
               /*往考试表填充信息，此时question设为空，为空时候往testpaper表填充信息，
               不为空时候，往中间表connect填充信息
               考试表仅仅有两部分组成：考试的名称，试卷的编号，
               试卷=考试表+试题库*/
               check=tr.insert(testNum,testName,question);
               if(check>0)
               {
                   /*正确填充考试信息(check>0)之后，进入试题录入部分*/
                   System.out.println("成功设置试卷信息，现在请往试卷中添加题目");
                   while (true)
                   {
                       System.out.println("请输入题库的编码");
                       question=input.next();
                       /*试题库的编码，防止过长或者过短*/
                       while (question.length()==0||question.length()>=a)
                       {
                           System.out.println("请按照正确的格式输入编码");
                           question=input.next();
                       }
                       /*此时question已经有了内容，应当往connect表填充信息*/
                       check = tr.insert(testNum, testName, question);
                       if(check>0)
                       {
                           System.out.println("成功录入！");
                       }
                       else
                       {
                           /*如果填充失败，认为试题库中不存在此题目*/
                           System.out.println("试题中不存在此编号的题目");
                       }
                       System.out.println("请选择是否继续添加题目1是其它不是");
                       choice=input.next();
                       /*输入1之后，继续录入*/
                       if("1".equals(choice))
                       {
                           System.out.println("继续录入！");
                       }
                       else {
                           break;
                       }
                   }
               }
               else {
                   System.out.println("不能设置相同的试卷编号!");
               }
               System.out.println("请选择是否继续录入1是其他不是");
               choice=input.next();
               if("1".equals(choice))
               {
                   System.out.println("继续录入！");
               }
               else {
                   break;
               }
           }
    }
     
 /**查看试题库的方法，调用Manager对象完成查询*/ 
    @Override
    public void select() throws SQLException, ClassNotFoundException {
       
        Manager manager=new Manager();
        manager.select();
    }
    /**出题人方法：查看自己出过的试题（前提是试题有题目）**/
    public void selectTestPaper() {
        String testNum;
        System.out.println("请输入您想通过什么方式查询1输入试卷编号，2默认查看全部");
        choice=input.next();
        /*选择专用符号choice*/
        String a="1",b="2";
        /*不按照正确的方式输入，将进入循环，直到以正确的方式输入为止*/
        while (!a.equals(choice)&&!b.equals(choice))
        {
            System.out.println("请以正确的方式输入,1输入试卷编号，2默认查看全部");
            choice=input.next();
        }
        switch (choice)
        {
            case "1":
            {
                /*通过试卷编号查看*/
                System.out.println("请输入试卷的编号");
                testNum=input.next();
                /*获取testnum*/
                while (!co.check(testNum))
                {
                    System.out.println("请以正确的格式输入试卷编号");
                    testNum=input.next();
                }
                /*此时testNum不为空*/
                list=tr.checkTestPaper(choice,testNum);
                break;
            }
            case "2":
            {
                //testNum为空时候，查询全部
                list=tr.checkTestPaper(choice,null);
                break;
            }
            default:
            {
                /*永不可到达区域，但是为了规范，仍然需要设置*/
                break;
            }
        }
        if(list!=null)
        {
            /*list不为空时候进行遍历*/
            for(TestPaper testPaper:list)
            {
                System.out.println("试卷编号:"+testPaper.getTestNum());
                System.out.println("考试名称:"+testPaper.getTestName());
                System.out.println("试问题编号:"+testPaper.getQuestionNum());
                System.out.println("试卷问题:"+testPaper.getQuestion());
                System.out.println("题目种类:"+testPaper.getKind());
            }
        }
        else
        {
            System.out.println("不存在试卷,或者此试卷没有题目");
        }
    }
    /**此方法为往已出试卷填充内容的方法**/
    public void changeTestPaper()
    {
        /*k为判断是否执行成功的标志*/
        int k;
        /*防止魔法值4的出现*/
        int a=4;
        /*testNum为试题的编号*/
        String testNum;
        /*questionnum为题目的编号*/
        String questionnum;
        System.out.println("请输入试卷的序号");
        testNum=input.next();
        while (!co.check(testNum))
        {
            System.out.println("请输入试卷的序号");
            testNum=input.next();
        }
        System.out.println("请选择您输入想往试卷中添加的题目序号:");
        questionnum=input.next();
        while (questionnum.length()==0||questionnum.length()>=a)
        {
            System.out.println("请以正确的形式输入想往试卷中添加的题目序号:");
            questionnum=input.next();
        }
        /*testName为空，仅仅往connect填充字段*/
        k= tr.insert(testNum,null,questionnum);
        if(k>0)
        {
            System.out.println("成功添加");
        }
        else {
            System.out.println("不存在此试卷");
        }
    }
}

```

下面是Service部分

```java
package Service;

import DAO.TeacherDAO;
import POJI.TestPaper;

import java.util.ArrayList;

/**
 * @author 25043
 */
public class TeacherService {
    /*创建DAO对象*/
    TeacherDAO teacherDAO=new TeacherDAO();

    public int insert(String testNum, String testName,String question)  {
        int k;
        String sql;
        String sql1=null;
        /*question为空，往试卷表填充信息*/
        if(question==null)
        {
            sql = "insert into testPaper(testnum,testname) values(?,?)";
        }
        /*question不为空，往connect填充信息*/
        else
        {
            sql=null;
            sql1="insert into connect(testnum,questionnum) values(?,?)";
        }
        /*DAO层是通过判断sql是不是空进行信息的填充的，如果sql不为空，往testpaper表填充信息，如果sql为空，往connect表填充信息*/
        k = teacherDAO.insert(sql1,sql, testNum, testName,question);
        return k;
    }

    public ArrayList<TestPaper> checkTestPaper(String choice, String testNum)
    {
        ArrayList<TestPaper> list;
        String sql = null;
        String a="1",b="2";
        /*响应Teacher类里面的方法*/
        if(a.equals(choice))
        {
            /*查看指定试题编号的sql语句*/
            sql="select*from testPaper,connect,questionBank where testPaper.testnum=connect.testnum and questionbank.num=connect.questionnum and testpaper.testnum=?";
        }
        else if(b.equals(choice))
        {
            /*查看所有试题的sql语句*/
            sql="select*from testPaper,connect,questionBank where testPaper.testnum=connect.testnum and questionbank.num=connect.questionnum";
        }
        list=teacherDAO.checkTestPaper(sql,testNum);
        return list;
    }
}

```

最后是DAO层

```java
package DAO;

import Condition.Connect;
import POJI.TestPaper;

import java.sql.*;
import java.util.ArrayList;

/**
 * @author 25043
 */
public class TeacherDAO {
    /**常量池部分**/
    Connection coon=null;
    Statement stmt=null;
    ResultSet rr=null;
    PreparedStatement ptsmt=null;
    ArrayList<TestPaper> list=null;
    public int insert(String sql1,String sql,String testNum,String testName,String question) {
        try{
            int k;
            coon = Connect.co();
            stmt = coon.createStatement();
            /*sql不为null，往testpaper表填充信息*/
            if(sql!=null)
            {
                ptsmt = coon.prepareStatement(sql);
                ptsmt.setString(1, testNum);
                ptsmt.setString(2, testName);
            }
            /*sql为空时候，往connect表填充信息*/
            else
            {
                ptsmt=coon.prepareStatement(sql1);
                ptsmt.setString(1,testNum);
                ptsmt.setString(2,question);
            }
            /*执行成功，返回k*/
            k = ptsmt.executeUpdate();
            return k;
        }catch (Exception e)
        {
            /*执行失败，打印异常，返回0*/
            e.printStackTrace();
            return 0;
        }
        finally {
            /*关闭接口，防止内存泄露*/
            Connect.close(rr,stmt,coon);
        }
    }

    public ArrayList<TestPaper> checkTestPaper(String sql, String testNum)  {
        try {
            TestPaper testPaper;
            coon=Connect.co();
            stmt=coon.createStatement();
            /*创建新的list*/
             list=new ArrayList<>();
             String testNum1;
             String testName;
             int questionNum;
             String question;
             String kind;
             /*testnum为空时候，执行查看所有试题的sql语句*/
            if(testNum==null)
            {
                rr=stmt.executeQuery(sql);
            }
            /*testNum不为null时候，将执行查看具体试题的sql语句*/
            else
            {
                ptsmt=coon.prepareStatement(sql);
                ptsmt.setString(1,testNum);
                rr=ptsmt.executeQuery();
            }
            /*遍历两张表查询的结果*/
            while (rr.next())
            {
                /*新建试卷对象*/
                testPaper=new TestPaper();
                /*获取试题编号*/
                testNum1=rr.getString(1);
                /*获取试题名称*/
                testName=rr.getString(2);
                /*获取问题编号*/
                questionNum=rr.getInt(4);
                /*获取题目的具体内容*/
                question=rr.getString(6);
                /*获取题目的种类*/
                kind=rr.getString(7);
                /*调用set方法完成赋值*/
                testPaper.setTestNum(testNum1);
                testPaper.setTestName(testName);
                testPaper.setQuestionNum(questionNum);
                testPaper.setQuestion(question);
                testPaper.setKind(kind);
                list.add(testPaper);
            }
            /*list集合如果存在，那么返回list，否则不返回*/
            if(list.size()>0)
            {
                return list;
            }
            else
            {
                return null;
            }
        }
        catch (Exception e)
        {
            e.printStackTrace();
            return null;
        }
        finally {
            Connect.close(rr,stmt,coon);
        }
    }
}

```



## 最后是Worker身份，安排考试场地的人，拥有3个方法

第一个：安排考试场地：arrange方法

第二个：查看考试场地对应的试题，check方法

第三个：查看试题库的方法，将重写teacher 的selectTestPaper方法

下面是数据库：

![image-20220325222645672](C:\Users\25043\AppData\Roaming\Typora\typora-user-images\image-20220325222645672.png)

roomnum为考试场地的编号（primary key）



testnum为试题的编号(foreign key references testpaper(testnum))

下面是Worker对象

```java
package MAIN;

import Condition.Condition;
import POJI.ClassRoom;
import POJI.TestPaper;
import Service.TeacherService;
import Service.WorkerService;
import java.util.ArrayList;
import java.util.Scanner;
/**
 * @author 25043
 */
public class Worker implements Select{
    /**试题集合*/
    ArrayList<TestPaper> list1=null;
    /**引入Scanner类*/
    Scanner input=new Scanner(System.in);
    /**试卷编号*/
    String testNum;
    /**考试场地编号*/
    String roomNum;
    /**选择判断**/
    String choice;
    /**引入工具类**/
    Condition condition=new Condition();
    /**创建TeacherService对象**/
    TeacherService tr=new TeacherService();
    /**创建WorkerService对象**/
    WorkerService workerService=new WorkerService();
    /**安排考试的方法*/
    public void arrange()
    {
        /*通过两个方法检测是否按照格式输入*/
        int a;
        System.out.println("请输入正确的试题号");
        testNum=input.next();
        while (!condition.check(testNum))
        {
            System.out.println("请输入正确的试题号");
            testNum=input.next();
        }
        System.out.println("请正确输入考试场地");
        roomNum=input.next();
        while (!condition.check(roomNum))
        {
            System.out.println("请输入正确的试题号");
            roomNum=input.next();
        }
        /*调用出题人的查看试题方法，默认通过试题编号查看，如果查询到此试题有题目，那么将可以安排考试*/
        list1=tr.checkTestPaper("1",testNum);
        if(list1!=null)
        {
            /*调用Service完成填充考试信息*/
            a = workerService.insert(roomNum, testNum);
            if (a > 0)
            {
                System.out.println("成功安排一场考试");
            }
            else
            {
                System.out.println("此场地已经有考试安排了，或者您输入了不正确的试题号");
            }
        }
        else
        {
            System.out.println("此试卷不存在题目，不能安排考试");
        }
    }
    public void check()
    {
        ArrayList<ClassRoom> list=null;
        roomNum=null;
        String a="1",b="2";
        System.out.println("您有以下两种方式查看，第1种输入考试场地编号，请输入1，第二种默认查看所有考试场地，请输入2");
        choice=input.next();
        while (!a.equals(choice)&&!b.equals(choice))
        {
            System.out.println("您有以下两种方式查看，第1种输入考试场地编号，请输入1，第二种默认查看所有考试场地，请输入2");
            choice=input.next();
        }
        switch (choice)
        {
            case "1":
            {
                System.out.println("请输入正确的考试场地编号");
                roomNum=input.next();
                while (!condition.check(roomNum))
                {
                    System.out.println("请按照正确格式再次输入考试场地编号");
                    roomNum=input.next();
                }
                list=workerService.check(choice,roomNum);
                break;
            }
            case "2":
            {
                list=workerService.check(choice, null);
                break;
            }
            default:{
                break;
            }
        }
        /*考试场地不为null*/
        if(list!=null)
        {
            for (ClassRoom classRoom : list)
            {
                testNum = classRoom.getTestNum();
                /*判断此试卷是否存在题目，如果不存在题目，将不会遍历*/
                list1 = tr.checkTestPaper("1", testNum);
                if (list1 != null) {
                    System.out.println("考试试卷是：" + classRoom.getTestNum());
                    System.out.println("考试场地是：" + classRoom.getRoomNum());
                } else {
                    System.out.println("此试卷没有填充题目");
                }
            }
        }
        else {
            System.out.println("尚未安排考试场地");
        }
    }

    /**查看所有试题**/@Override
    public void select()
    {
        /*借助Teacher类完成查看*/
        Teacher teacher=new Teacher();
        teacher.selectTestPaper();
    }
}

```

下面是WorkerService

```java
package Service;

import DAO.WorkerDAO;
import POJI.ClassRoom;

import java.util.ArrayList;

/**
 * @author 25043
 */
public class WorkerService {
    /**创建worker对象*/
    WorkerDAO workerDAO=new WorkerDAO();
     /**往考试场地填充信息*/
    public int insert(String roomNum, String testNum)
    {
        int a;
        String sql="insert into classroom(roomNum,testNum) values(?,?)";
        a=workerDAO.insert(sql,roomNum,testNum);
        return a;
    }
    /**查询考试场地*/
    public ArrayList<ClassRoom> check(String choice, String roomNum) {
        ArrayList<ClassRoom> list;
        String a="1",b="2";
        String sql=null;
        if(a.equals(choice))
        {
            /*通过classroom编号查看*/
            sql = "select*from classroom where roomNum=?";
        }
        else if(b.equals(choice))
        {
            roomNum=null;
            /*查看所有classroom*/
            sql="select*from classroom";
        }
        list=workerDAO.check(sql,roomNum);
        return list;
    }
}

```

最后是DAO

```java
package DAO;

import Condition.Connect;
import POJI.ClassRoom;

import java.sql.*;
import java.util.ArrayList;

/**
 * @author 25043
 */
public class WorkerDAO {
    Connection coon=null;
    Statement stmt=null;
    ResultSet rr=null;
    PreparedStatement ptsmt=null;
    ArrayList<ClassRoom> list=null;
    public int insert(String sql, String roomNum, String testNum)
    {
        try {
             int a;
             coon= Connect.co();
             stmt=coon.createStatement();
             /*预处理sql语句*/
             ptsmt=coon.prepareStatement(sql);
             ptsmt.setString(1,roomNum);
             ptsmt.setString(2,testNum);
             a= ptsmt.executeUpdate();
             return a;
        }catch (Exception e)
        {
            /*出现异常返回0*/
            e.printStackTrace();
            return 0;
        }
        finally {
            Connect.close(rr,stmt,coon);
        }
    }

    public ArrayList<ClassRoom> check(String sql,String roomNum) {
        try {
            list=new ArrayList<>();
            coon=Connect.co();
            stmt=coon.createStatement();
            String roomNum1;
            String testNum;
            ClassRoom classRoom;
            /*roomNum不为空时候，查看指定的考试场地*/
            if(roomNum!=null)
            {
                ptsmt=coon.prepareStatement(sql);
                ptsmt.setString(1,roomNum);
                rr= ptsmt.executeQuery();
            }
            else {
                /*为空时候查看所有考试场地*/
                rr=stmt.executeQuery(sql);
            }
            while (rr.next())
            {
                /*遍历考试场地对象*/
                classRoom=new ClassRoom();
                roomNum1=rr.getString(1);
                testNum=rr.getString(2);
                classRoom.setRoomNum(roomNum1);
                classRoom.setTestNum(testNum);
                list.add(classRoom);
            }
            if(list.size()>0)
            {
                return list;
            }
            else {
                return null;
            }
        }catch (Exception e)
        {
            e.printStackTrace();
            return null;
        }finally {
            Connect.close(rr,stmt,coon);
        }
    }
}

```

